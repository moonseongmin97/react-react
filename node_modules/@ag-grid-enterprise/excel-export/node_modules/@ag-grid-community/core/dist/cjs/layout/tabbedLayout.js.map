{"version":3,"sources":["../../src/ts/layout/tabbedLayout.ts"],"names":[],"mappings":"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","file":"tabbedLayout.js","sourcesContent":["import { Promise, _ } from '../utils';\nimport { RefSelector } from '../widgets/componentAnnotations';\nimport { PostConstruct, Autowired } from '../context/context';\nimport { Constants } from '../constants';\nimport { FocusController } from '../focusController';\nimport { ManagedTabComponent } from '../widgets/managedTabComponent';\n\nexport class TabbedLayout extends ManagedTabComponent {\n\n    @Autowired('focusController') private focusController: FocusController;\n\n    @RefSelector('eHeader') private eHeader: HTMLElement;\n    @RefSelector('eBody') private eBody: HTMLElement;\n\n    private params: TabbedLayoutParams;\n    private afterAttachedParams: any;\n    private items: TabbedItemWrapper[] = [];\n    private activeItem: TabbedItemWrapper;\n\n    constructor(params: TabbedLayoutParams) {\n        super(TabbedLayout.getTemplate(params.cssClass));\n        this.params = params;\n\n        if (params.items) {\n            params.items.forEach(item => this.addItem(item));\n        }\n    }\n\n    @PostConstruct\n    public init(): void {\n        this.addDestroyableEventListener(this.getGui(), 'keydown', this.handleKeyDown.bind(this));\n    }\n\n    private handleKeyDown(e: KeyboardEvent): void {\n        switch (e.keyCode) {\n            case Constants.KEY_RIGHT:\n            case Constants.KEY_LEFT:\n                if (!this.eHeader.contains(document.activeElement)) { return; }\n                const currentPosition = this.items.indexOf(this.activeItem);\n                const nextPosition = e.keyCode === Constants.KEY_RIGHT ? Math.min(currentPosition + 1, this.items.length - 1) : Math.max(currentPosition - 1, 0);\n\n                if (currentPosition === nextPosition) { return; }\n                e.preventDefault();\n                const nextItem = this.items[nextPosition];\n\n                this.showItemWrapper(nextItem);\n                nextItem.eHeaderButton.focus();\n                break;\n            case Constants.KEY_UP:\n            case Constants.KEY_DOWN:\n                e.stopPropagation();\n                break;\n        }\n    }\n\n    protected onTabKeyDown(e: KeyboardEvent) {\n        super.onTabKeyDown(e);\n\n        const focusableItems = this.focusController.findFocusableElements(this.eBody, '.ag-set-filter-list *, .ag-menu-list *');\n        const activeElement = document.activeElement as HTMLElement;\n\n        if (this.eHeader.contains(activeElement)) {\n            if (focusableItems.length) {\n                focusableItems[e.shiftKey ? focusableItems.length - 1 : 0].focus();\n            }\n        } else {\n            const focusedPosition = focusableItems.indexOf(activeElement);\n            const nextPosition = e.shiftKey ? focusedPosition - 1 : focusedPosition + 1;\n\n            if (nextPosition < 0 || nextPosition >= focusableItems.length) {\n                this.activeItem.eHeaderButton.focus();\n                return;\n            }\n\n            const nextItem = focusableItems[nextPosition];\n\n            if (nextItem) { nextItem.focus(); }\n        }\n    }\n\n    private static getTemplate(cssClass?: string) {\n        return `<div class=\"ag-tabs ${cssClass}\">\n            <div ref=\"eHeader\" class=\"ag-tabs-header ${cssClass ? `${cssClass}-header` : ''}\"></div>\n            <div ref=\"eBody\" class=\"ag-tabs-body ${cssClass ? `${cssClass}-body` : ''}\"></div>\n        </div>`;\n    }\n\n    public setAfterAttachedParams(params: any): void {\n        this.afterAttachedParams = params;\n    }\n\n    public getMinDimensions(): {width: number, height: number} {\n        const eDummyContainer = this.getGui().cloneNode(true) as HTMLElement;\n        const eDummyBody = eDummyContainer.querySelector('[ref=\"eBody\"]') as HTMLElement;\n\n        // position fixed, so it isn't restricted to the boundaries of the parent\n        eDummyContainer.style.position = 'fixed';\n\n        // we put the dummy into the body container, so it will inherit all the\n        // css styles that the real cells are inheriting\n        this.getGui().appendChild(eDummyContainer);\n\n        let minWidth = 0;\n        let minHeight = 0;\n\n        this.items.forEach((itemWrapper: TabbedItemWrapper) => {\n            _.clearElement(eDummyBody);\n\n            const eClone: HTMLElement = itemWrapper.tabbedItem.bodyPromise.resolveNow(null, body => body.cloneNode(true)) as HTMLElement;\n            if (eClone == null) { return; }\n\n            eDummyBody.appendChild(eClone);\n\n            if (minWidth < eDummyContainer.offsetWidth) {\n                minWidth = eDummyContainer.offsetWidth;\n            }\n            if (minHeight < eDummyContainer.offsetHeight) {\n                minHeight = eDummyContainer.offsetHeight;\n            }\n        });\n\n        this.getGui().removeChild(eDummyContainer);\n\n        return { height: minHeight, width: minWidth };\n    }\n\n    public showFirstItem(): void {\n        if (this.items.length > 0) {\n            this.showItemWrapper(this.items[0]);\n        }\n    }\n\n    private addItem(item: TabbedItem): void {\n        const eHeaderButton = document.createElement('span');\n        eHeaderButton.tabIndex = -1;\n        eHeaderButton.appendChild(item.title);\n        _.addCssClass(eHeaderButton, 'ag-tab');\n        this.eHeader.appendChild(eHeaderButton);\n\n        const wrapper: TabbedItemWrapper = {\n            tabbedItem: item,\n            eHeaderButton: eHeaderButton\n        };\n        this.items.push(wrapper);\n\n        eHeaderButton.addEventListener('click', this.showItemWrapper.bind(this, wrapper));\n    }\n\n    public showItem(tabbedItem: TabbedItem): void {\n        const itemWrapper = _.find(this.items, wrapper => {\n            return wrapper.tabbedItem === tabbedItem;\n        });\n        if (itemWrapper) {\n            this.showItemWrapper(itemWrapper);\n        }\n    }\n\n    private showItemWrapper(wrapper: TabbedItemWrapper): void {\n        if (this.params.onItemClicked) {\n            this.params.onItemClicked({item: wrapper.tabbedItem});\n        }\n\n        if (this.activeItem === wrapper) {\n            _.callIfPresent(this.params.onActiveItemClicked);\n            return;\n        }\n\n        _.clearElement(this.eBody);\n        wrapper.tabbedItem.bodyPromise.then(body => {\n            this.eBody.appendChild(body);\n            body.focus();\n        });\n\n        if (this.activeItem) {\n            _.removeCssClass(this.activeItem.eHeaderButton, 'ag-tab-selected');\n        }\n        _.addCssClass(wrapper.eHeaderButton, 'ag-tab-selected');\n\n        this.activeItem = wrapper;\n\n        if (wrapper.tabbedItem.afterAttachedCallback) {\n            wrapper.tabbedItem.afterAttachedCallback(this.afterAttachedParams);\n        }\n    }\n}\n\nexport interface TabbedLayoutParams {\n    items: TabbedItem[];\n    cssClass?: string;\n    onItemClicked?: Function;\n    onActiveItemClicked?: Function;\n}\n\nexport interface TabbedItem {\n    title: Element;\n    bodyPromise: Promise<HTMLElement>;\n    name: string;\n    afterAttachedCallback?: Function;\n}\n\ninterface TabbedItemWrapper {\n    tabbedItem: TabbedItem;\n    eHeaderButton: HTMLElement;\n}"]}